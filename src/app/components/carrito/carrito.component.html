<div class="carrito-container">
  <!-- Header with close button -->
  <div class="carrito-header">
    <h2>Resumen de tu pedido</h2>
    <button class="cerrar-btn" (click)="volverAlMenu()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Tabs de selecci√≥n de tipo de orden -->
  <div class="selection-buttons">
    <button
      [class.active]="selectedType === 'takeaway'"
      (click)="setOrderType('takeaway')"
    >
      <span>Recoger</span>
    </button>
    
    <button
      [class.active]="selectedType === 'restaurant'"
      (click)="setOrderType('restaurant')"
    >
      <span>Restaurante</span>
    </button>
    
    <button
      [class.active]="selectedType === 'delivery'"
      (click)="setOrderType('delivery')"
    >
      <span>Domicilio</span>
    </button>
  </div>

  <div *ngIf="showDireccion" class="direccion-input">
    <h3><label for="direccion">Direcci√≥n de entrega</label></h3>
    
    <input
      id="direccion"
      type="text"
      [(ngModel)]="direccion"
      placeholder="Ej: Calle 80N # 99 - 30 B/La Paz"
      [ngClass]="{'invalid-input': direccion === '' && formSubmitted}"
      (blur)="validateDireccion()"
      #direccionInput
    />
        
    <div *ngIf="direccion === '' && formSubmitted" class="error-message">
      Ingresa la direcci√≥n de entrega o selecciona
    </div>
  </div>

  <h3>Resumen de tu pedido</h3>
  
  <ng-container *ngIf="carrito.length > 0; else carritoVacio">
    <!-- Product items -->
    <div *ngFor="let item of carrito; let i = index" class="producto-carrito">
      <!-- Imagen del producto -->
    <img *ngIf="item.image" class="producto-img" [src]="item.image" [alt]="item.name">
      <div class="producto-info">
        <div class="producto-detalle">
          <h4>{{ item.name }}</h4>
          <p class="precio">${{ item.precioTotal | number }}</p>
        
          <ng-container *ngIf="item.customization?.additions?.length > 0">
            <p class="adiciones">üü¢ Adiciones:</p>
            <ul>
              <li *ngFor="let add of item.customization.additions">
                {{ add.nombre }} (x{{ add.cantidad }}) - ${{ add.subtotal | number }}
              </li>
            </ul>
          </ng-container>
        
          <ng-container *ngIf="item.customization?.exclusions?.length > 0">
            <p class="exclusiones">üî¥ Sin:</p>
            <ul>
              <li *ngFor="let exc of item.customization.exclusions">
                {{ exc }}
              </li>
            </ul>
          </ng-container>
        </div>
        
        <div class="cantidad-control">
          <button class="control-btn" (click)="modificarCantidad(i, item.cantidad - 1)">‚àí</button>
          <span class="cantidad">{{ item.cantidad }}</span>
          <button class="control-btn" (click)="modificarCantidad(i, item.cantidad + 1)">+</button>
        </div>
      </div>
      
      
    </div>

    <!-- Order summary -->
    <div class="order-summary">
      <div class="subtotal">
        <p>Subtotal</p>
        <p>${{ subtotal | number }}</p>
      </div>
      <div class="total">
        <p><strong>Total tu pedido</strong></p>
        <p><strong>${{ total | number }}</strong></p>
      </div>
      <div class="mensaje-importante">
        <p><strong>Importante:</strong> Nuestros pedidos se realizan por medio de Whatsapp, al seleccionar "confirmar pedido" ser√°s dirigido a la app.</p>
      </div>
      <button class="reiniciar-btn" (click)="vaciarCarrito()">
        Reiniciar pedido
      </button>
    </div>
  </ng-container>

  <ng-template #carritoVacio>
    <p class="carrito-vacio">Tu carrito est√° vac√≠o.</p>
    <div class="btn-carrito-vacio">
      <button mat-raised-button color="accent"  (click)="volverAlMenu()">Volver al men√∫</button>
    </div>
  </ng-template>
</div>

<!-- Confirm order button - Fixed at bottom -->
<div class="confirmar-pedido-container" *ngIf="mostrarConfirmarPedido">
  <button class="confirmar-pedido" (click)="irAPagar()">
    Confirmar pedido
  </button>
</div>

